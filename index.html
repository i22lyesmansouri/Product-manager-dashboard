<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Electro Jazera</title>

<style>
html,body{margin:0;font-family:Arial,sans-serif;background:#fff;color:#111}
header{background:#fff;padding:.6rem 1rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 6px rgba(0,0,0,0.1);position:sticky;top:0;z-index:10}
.logo{height:40px}
main{padding:1rem}

#productList{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:.7rem;
}

@media(max-width:600px){
#productList{grid-template-columns:repeat(2,1fr);}
}

.product{
background:#fff;
border-radius:12px;
overflow:hidden;
box-shadow:0 2px 6px rgba(0,0,0,0.08);
cursor:pointer;
transition:.2s;
}

.product:hover{
transform:translateY(-3px);
box-shadow:0 6px 14px rgba(0,0,0,0.15);
}

.product img{
width:100%;
height:150px;
object-fit:cover;
display:block;
}

.product-info{
display:flex;
justify-content:space-between;
padding:.6rem .7rem;
font-weight:600;
}

.price{font-weight:700}

.modal{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,0.6);
align-items:center;
justify-content:center;
z-index:50;
}

.modal-content{
background:#fff;
padding:1rem;
border-radius:12px;
width:100%;
max-width:420px;
}

.modal-content img{
width:100%;
height:220px;
object-fit:cover;
border-radius:10px;
margin-bottom:10px;
}

button{
padding:.5rem .8rem;
border:none;
border-radius:8px;
cursor:pointer;
}

.update-btn{background:#007bff;color:#fff}
.close-btn{background:#ccc}
</style>
</head>
<body>

<header>
<img src="icon-192.png" class="logo">
</header>

<main>
<div id="productList"></div>
</main>

<div id="detailsModal" class="modal">
<div class="modal-content">
<h3 id="dName"></h3>
<img id="dImage">
<div><strong>Buy:</strong> <span id="dBuy"></span></div>
<div><strong>Sell:</strong> <span id="dSell"></span></div>
<div><strong>Stock:</strong> <span id="dStock"></span></div>
<br>
<div style="display:flex;gap:.5rem;">
<button class="update-btn" onclick="closeDetails()">Close</button>
</div>
</div>
</div>

<script>
let db;
const request=indexedDB.open("ProductManagerDB",1);

request.onupgradeneeded=e=>{
db=e.target.result;
const store=db.createObjectStore("products",{keyPath:"id",autoIncrement:true});
};

request.onsuccess=e=>{db=e.target.result;renderProducts();};

function formatSmartPrice(v){
const n=parseFloat(v);
if(Number.isInteger(n)) return n;
return n.toFixed(2).replace(/\.00$/,'');
}

function renderProducts(){
const tx=db.transaction("products","readonly");
const store=tx.objectStore("products");
const req=store.getAll();

req.onsuccess=()=>{
const list=document.getElementById("productList");
list.innerHTML="";
(req.result||[]).forEach(p=>{

const card=document.createElement("div");
card.className="product";

card.innerHTML=`
<img src="${p.image||''}">
<div class="product-info">
<span>${p.name}</span>
<span class="price">${formatSmartPrice(p.sellPrice)}</span>
</div>`;

card.onclick=()=>openDetails(p);

let timer;
card.onmousedown=()=>{
timer=setTimeout(()=>{
if(confirm("Delete this product?")){
deleteProduct(p.id);
}
},800);
};
card.onmouseup=()=>clearTimeout(timer);
card.onmouseleave=()=>clearTimeout(timer);

list.appendChild(card);
});
};
}

function deleteProduct(id){
const tx=db.transaction("products","readwrite");
tx.objectStore("products").delete(id);
tx.oncomplete=()=>renderProducts();
}

function openDetails(p){
document.getElementById("dName").innerText=p.name;
document.getElementById("dImage").src=p.image||'';
document.getElementById("dBuy").innerText=formatSmartPrice(p.buyPrice);
document.getElementById("dSell").innerText=formatSmartPrice(p.sellPrice);
document.getElementById("dStock").innerText=p.stock;
document.getElementById("detailsModal").style.display="flex";
}

function closeDetails(){
document.getElementById("detailsModal").style.display="none";
}

window.onclick=e=>{
if(e.target.id==="detailsModal") closeDetails();
};
</script>

</body>
</html>